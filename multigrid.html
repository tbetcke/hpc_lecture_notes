
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Multigrid Methods &#8212; Techniques of High-Performance Computing - Lecture Notes</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Simple time-stepping" href="simple_time_stepping.html" />
    <link rel="prev" title="Using petsc4py for sparse linear systems" href="petsc_for_sparse_systems.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/cpu_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Techniques of High-Performance Computing - Lecture Notes</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to Techniques of High-Performance Computing
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  High-Performance Computing with Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="what_is_hpc.html">
   What is High-Performance Computing?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hpc_languages.html">
   Languages for High-Performance Computing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="python_hpc_tools.html">
   Python HPC Tools
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numpy_and_data_layouts.html">
   Memory layout and Numpy arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parallel_principles.html">
   Parallel Computing Principles in Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="working_with_numba.html">
   Working with Numba
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="simd.html">
   SIMD Autovectorization in Numba
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numexpr.html">
   A Numexpr example
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gpu_introduction.html">
   An Introduction to GPU Computing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cuda_introduction.html">
   A tour of CUDA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numba_cuda.html">
   Numba Cuda in Practice
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rbf_evaluation.html">
   GPU accelerated evaluation of particle sums
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Sparse Linear Algebra
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="sparse_linalg_pde.html">
   The need for sparse linear algebra - A PDE example
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sparse_data_structures.html">
   Sparse Matrix data structures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sparse_solvers_introduction.html">
   An introduction to sparse linear system solvers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="it_solvers1.html">
   Iterative Solvers 1 - Krylov subspaces, Arnoldi Iteration and the Full Orthogonalisation Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="it_solvers2.html">
   Iterative Solvers 2 - From FOM to GMRES
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="it_solvers3.html">
   Iterative Solvers 3 - The Conjugate Gradient Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="it_solvers4.html">
   Iterative Solvers 4 - Preconditioning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sparse_direct_solvers.html">
   Sparse Direct Solvers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="petsc_for_sparse_systems.html">
   Using petsc4py for sparse linear systems
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Multigrid Methods
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Time-Dependent Problems
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="simple_time_stepping.html">
   Simple time-stepping
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wave_equation.html">
   Discretising the wave equation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Conclusions
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="further_topics.html">
   Further topics
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Assignments
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="2022-assignment_1.html">
   Assignment 1 - Matrix-matrix multiplication
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2022-assignment_2.html">
   Assignment 2 - Solving two 1D problems
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tasks for Monday Practical Classes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="2022-class_1.html">
   Class 1 (Monday 10 October)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2022-class_2.html">
   Class 2 (Monday 17 October)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2022-class_3.html">
   Class 3 (Monday 24 October)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2022-class_4.html">
   Class 4 (Monday 31 October)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2022-class_5.html">
   Class 5 (Monday 14 November)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Additional notes from 2022
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="2022_matrices_and_simultaneous_equations.html">
   Matrices and simultaneous equations
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/multigrid.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/multigrid.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-model-problem">
   The model problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#eigenvalues-and-eigenvectors-of-the-model-problem">
   Eigenvalues and eigenvectors of the model problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#richardson-iteration">
   Richardson Iteration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#applying-the-richardson-iteration-to-the-model-problem">
   Applying the Richardson iteration to the model problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#error-reduction-on-the-coarse-mesh">
   Error reduction on the coarse mesh
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#moving-between-the-fine-mesh-and-the-coarse-mesh">
   Moving between the fine mesh and the coarse mesh
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-full-multigrid-cycle">
   The full multigrid cycle
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#algebraic-multigrid">
   Algebraic multigrid
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Multigrid Methods</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-model-problem">
   The model problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#eigenvalues-and-eigenvectors-of-the-model-problem">
   Eigenvalues and eigenvectors of the model problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#richardson-iteration">
   Richardson Iteration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#applying-the-richardson-iteration-to-the-model-problem">
   Applying the Richardson iteration to the model problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#error-reduction-on-the-coarse-mesh">
   Error reduction on the coarse mesh
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#moving-between-the-fine-mesh-and-the-coarse-mesh">
   Moving between the fine mesh and the coarse mesh
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-full-multigrid-cycle">
   The full multigrid cycle
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#algebraic-multigrid">
   Algebraic multigrid
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="multigrid-methods">
<h1>Multigrid Methods<a class="headerlink" href="#multigrid-methods" title="Permalink to this headline">#</a></h1>
<p>Multigrid methods are tremendously successful solvers for matrices arising from non-oscillatory PDE problems. The idea is that we consider a problem on different refinement levels and use solutions on coarser levels to improve upon solutions on finer levels. In this notebook we will closely follow the notes on multigrid methods in the book <a class="reference external" href="https://www-users.cs.umn.edu/~saad/IterMethBook_2ndEd.pdf">Iterative Methods for Sparse Linear Systems</a> by Yousef Saad.</p>
<section id="the-model-problem">
<h2>The model problem<a class="headerlink" href="#the-model-problem" title="Permalink to this headline">#</a></h2>
<p>We consider the following model problem</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
-u''(x) &amp;= f(x),~x\in [0, 1]\nonumber\\
u(0) = u(1) &amp;= 0\nonumber
\end{align}
\end{split}\]</div>
<p>We choose <span class="math notranslate nohighlight">\(n\)</span> equally spaced points</p>
<div class="math notranslate nohighlight">
\[
x_i = i \times h,~i=0,\dots, n+1, h=1/(n+1)
\]</div>
<p>and approximate</p>
<div class="math notranslate nohighlight">
\[
-u''(x_i) \approx \frac{-x_{i+1} + 2x_i - x_{i-1}}{h^2}
\]</div>
<p>This gives us the linear system of equations <span class="math notranslate nohighlight">\(Ax = b\)</span> with</p>
<div class="math notranslate nohighlight">
\[\begin{split}
A = \begin{bmatrix}2    &amp;   -1     &amp;      &amp;      &amp;    \\
                   -1   &amp;   2      &amp;  -1  &amp;      &amp;    \\
                         &amp;  \ddots     &amp;   \ddots  &amp;  \ddots  &amp;     \\
                         &amp;             &amp;   -1      &amp;    2      &amp; -1 \\
                         &amp;             &amp;           &amp;   -1      &amp;  2
     \end{bmatrix},\quad
     b = h^2\begin{bmatrix}f(x_1)\\ f(x_2)\\ \vdots \\ f(x_{n-1}) \\ f(x_n)\end{bmatrix}.
\end{split}\]</div>
</section>
<section id="eigenvalues-and-eigenvectors-of-the-model-problem">
<h2>Eigenvalues and eigenvectors of the model problem<a class="headerlink" href="#eigenvalues-and-eigenvectors-of-the-model-problem" title="Permalink to this headline">#</a></h2>
<p>In order to later understand how multigrid works we need to investigate the behaviour of the eigenvalues and eigenvectors of <span class="math notranslate nohighlight">\(A\)</span>. Let us define <span class="math notranslate nohighlight">\(A\)</span> and compute them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">d1</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">d2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="n">k</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">lam</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">V</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;k-x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;k=1&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">V</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k-x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;k=2&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">V</span><span class="p">[:,</span> <span class="mi">10</span><span class="p">],</span> <span class="s1">&#39;k-x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;k=10&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">V</span><span class="p">[:,</span> <span class="mi">15</span><span class="p">],</span> <span class="s1">&#39;k-x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;k=15&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/multigrid_6_0.png" src="_images/multigrid_6_0.png" />
</div>
</div>
<p>One can find an explicit representation of the eigenvalues and eigenvectors for this matrix. It holds that <span class="math notranslate nohighlight">\(Av_k = \lambda_k v_k\)</span> with</p>
<div class="math notranslate nohighlight">
\[
\lambda_k = 4\sin^2\frac{\theta_k}{2},\quad \theta_k = \frac{k\pi}{n+1},\quad v_k = \sin(k\pi x_i)
\]</div>
</section>
<section id="richardson-iteration">
<h2>Richardson Iteration<a class="headerlink" href="#richardson-iteration" title="Permalink to this headline">#</a></h2>
<p>We now introduce a very simple iteration method for the above matrix and try to exactly understand what works and what doesn’t with this method. This will give us the right ideas that will lead us to the multigrid iteration.</p>
<p>The Richardson iteration is a very simple iterative method. We start with</p>
<div class="math notranslate nohighlight">
\[
b - Ax = 0
\]</div>
<p>Now multiply this equation with a damping factor <span class="math notranslate nohighlight">\(\omega\)</span> and add <span class="math notranslate nohighlight">\(x\)</span> on both sides of the equation. We obtain the fixed point equation</p>
<div class="math notranslate nohighlight">
\[
x = x + \omega(b - Ax).
\]</div>
<p>This motivates the simple fixed point iteration</p>
<div class="math notranslate nohighlight">
\[
x_{j+1} = x_j + \omega(b-Ax_j) = (I - \omega A)x_j + \omega b.
\]</div>
<p>This iteration is of the form <span class="math notranslate nohighlight">\(x_{j+1} = M_{\omega}x_j + f_{\omega}\)</span> with <span class="math notranslate nohighlight">\(M_{\omega} = I-\omega A\)</span> and <span class="math notranslate nohighlight">\(f_{\omega} = \omega b\)</span>. Let us see under which conditions this iteration converges. The exact solution <span class="math notranslate nohighlight">\(x^*\)</span> satisfies <span class="math notranslate nohighlight">\(x^* = M_\omega x^* + f_\omega\)</span>. Defining the error <span class="math notranslate nohighlight">\(e_j = x^* - x_j\)</span> and subtracting equations gives us</p>
<div class="math notranslate nohighlight">
\[
e_{j+1} = M_{\omega}e_j = M_\omega^{j+1} e_0.
\]</div>
<p>Let the eigenvalues and eigenvectors of <span class="math notranslate nohighlight">\(M_{\omega}\)</span> by denoted by <span class="math notranslate nohighlight">\(\mu_i\)</span> and <span class="math notranslate nohighlight">\(w_i\)</span>. We assume that <span class="math notranslate nohighlight">\(M_{\omega}\)</span> is diagonalizable. This implies that we can write</p>
<div class="math notranslate nohighlight">
\[
e_0 = \sum_{i}\alpha_iw_i
\]</div>
<p>for some coefficients <span class="math notranslate nohighlight">\(\alpha_i\)</span>. We hence have that</p>
<div class="math notranslate nohighlight">
\[
e_j = \sum_i \alpha_i \mu_i^{j}w_i.
\]</div>
<p>It follows that the error <span class="math notranslate nohighlight">\(e_j\)</span> converges to zero if and only if for all eigenvalues <span class="math notranslate nohighlight">\(\mu_i\)</span> we have <span class="math notranslate nohighlight">\(|\mu_i| &lt; 1\)</span>. For the Richardson method applied to our example problem we have that <span class="math notranslate nohighlight">\(\mu_i = 1 - \omega \lambda_i\)</span>, where <span class="math notranslate nohighlight">\(\lambda_i\)</span> was defined earlier. We obtain the bound</p>
<div class="math notranslate nohighlight">
\[
1 - \omega\lambda_n \leq \mu_i \leq 1 - \omega \lambda_1.
\]</div>
<p>We need to choose <span class="math notranslate nohighlight">\(\omega\)</span> such that <span class="math notranslate nohighlight">\(|\mu_i| &lt; 1\)</span> or equivalently <span class="math notranslate nohighlight">\(-1 &lt; \mu_i &lt; 1\)</span>. The upper bound is always satisfied if <span class="math notranslate nohighlight">\(\omega &gt; 0\)</span> as the above equation shows. For the lower bound we need to choose <span class="math notranslate nohighlight">\(\omega\)</span> such that <span class="math notranslate nohighlight">\(-1 &lt; 1-\omega\lambda_n\)</span> or equivalently</p>
<div class="math notranslate nohighlight">
\[
0 &lt; \omega &lt; \frac{2}{\lambda_n}.
\]</div>
<p>Hence, if <span class="math notranslate nohighlight">\(\gamma\)</span> is an upper bound to <span class="math notranslate nohighlight">\(\lambda_n\)</span> then the Richardson iteration converges if <span class="math notranslate nohighlight">\(\omega = \frac{1}{\gamma}\)</span>. For the error reduction in each step of the Richardson iteration applied to our model problem we obtain</p>
<div class="math notranslate nohighlight">
\[
e_j = \sum_i\left(1 - \frac{\lambda_i}{\gamma}\right)^j\alpha_iv_i,
\]</div>
<p>where the <span class="math notranslate nohighlight">\(v_i\)</span> are the eigenvectors of our matrix <span class="math notranslate nohighlight">\(A\)</span> and the <span class="math notranslate nohighlight">\(\alpha_i\)</span> are the expansion coefficients of <span class="math notranslate nohighlight">\(e_0\)</span> in this basis.</p>
</section>
<section id="applying-the-richardson-iteration-to-the-model-problem">
<h2>Applying the Richardson iteration to the model problem<a class="headerlink" href="#applying-the-richardson-iteration-to-the-model-problem" title="Permalink to this headline">#</a></h2>
<p>Now remember that the eigenvalues of <span class="math notranslate nohighlight">\(A\)</span> are given by <span class="math notranslate nohighlight">\(\lambda_j = 4\sin^2\frac{\theta_j}{2}\)</span>. An upper bound is therefore immediately obtained as <span class="math notranslate nohighlight">\(\lambda_n &lt; 4\)</span>. We hence choose <span class="math notranslate nohighlight">\(\omega = \frac{1}{4}\)</span>. The following code implements the Richardson iteration with this parameter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">richardson</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Performs n steps of Richardson iteration. Returns residual.&quot;&quot;&quot;</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">b</span>
    
    <span class="n">residuals</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsteps</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">.25</span> <span class="o">*</span> <span class="n">res</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">A</span> <span class="o">@</span> <span class="n">x</span>
        <span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
        
    <span class="k">return</span> <span class="n">residuals</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
<span class="n">residuals</span> <span class="o">=</span> <span class="n">richardson</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;residual&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/multigrid_12_0.png" src="_images/multigrid_12_0.png" />
</div>
</div>
<p>The iteration converges but very slowly. What is the reason? Each error component is reduced by the factor <span class="math notranslate nohighlight">\(\left(1 - \frac{\lambda_k}{\gamma}\right)\)</span>. This means that the error reduction is worst for the smallest eigenvalue. We obtain for <span class="math notranslate nohighlight">\(\lambda_1\)</span></p>
<div class="math notranslate nohighlight">
\[
(1 - \frac{\lambda_1}{4})^j = 1 - \sin^2\frac{\pi}{2(n+1)}\approx 1 - \left(\frac{\pi h}{2}\right)^2 = 1 - \mathcal{O}(h^2).
\]</div>
<p>As <span class="math notranslate nohighlight">\(h\)</span> descreases the rate of convergence becomes arbitrarily slow. However, the highly oscillatory eigenvalues give a rapid error reduction. For eigenvalues with <span class="math notranslate nohighlight">\(k&gt;n /2\)</span> we have</p>
<div class="math notranslate nohighlight">
\[
1 - \sin^2\frac{k\pi}{2(n+1)}=\cos^2\frac{k\pi}{2(n+1)}\leq \frac{1}{2}.
\]</div>
<p>Hence, the high-frequency errors (those associated with higher oscillatory eigenvectors) are reduced rapidly. The reduction factors behave as follows with respect to the index <span class="math notranslate nohighlight">\(k\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">krange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">factors</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">krange</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span><span class="o">**</span><span class="mi">2</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">krange</span><span class="p">,</span> <span class="n">factors</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;reduction factor&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/multigrid_14_0.png" src="_images/multigrid_14_0.png" />
</div>
</div>
<p>The above plot shows the reduction factors. The ones associated with the smaller <span class="math notranslate nohighlight">\(k\)</span> belong to low frequency eigenmodes. The once associated with higher <span class="math notranslate nohighlight">\(k\)</span> belong to high frequency eigenmodes. The plot below shows a low oscillatory mode and a high oscillatory mode. We talk about low frequency up until <span class="math notranslate nohighlight">\(k\leq n/2\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)</span>
<span class="n">low_mode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">xrange</span><span class="p">)</span>
<span class="n">high_mode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">40</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">xrange</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xrange</span><span class="p">,</span> <span class="n">low_mode</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;lowly frequency mode (k=5)&#39;</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span>  <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xrange</span><span class="p">,</span> <span class="n">high_mode</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;high frequency mode (k=40)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;highly oscillatory mode (k=40)&#39;)
</pre></div>
</div>
<img alt="_images/multigrid_16_1.png" src="_images/multigrid_16_1.png" />
</div>
</div>
</section>
<section id="error-reduction-on-the-coarse-mesh">
<h2>Error reduction on the coarse mesh<a class="headerlink" href="#error-reduction-on-the-coarse-mesh" title="Permalink to this headline">#</a></h2>
<p>The multigrid idea is as follows. High-frequency components in the error are rapidly reduced through the Richardson iteration. In order to reduce low-frequency errors we move to a coarser mesh. On a coarser mesh some of the modes that are low-frequency on the original mesh now become high-frequency and are therefore effectively reduced on the coarser mesh. We then need to update our solution on the fine mesh again. We can do almost arbitrary cycles between coarser and finer meshes, recursing several stages down the hierarchy to very coarse meshes and back.</p>
<p>Let’s work out this idea. For simplicity we assume that <span class="math notranslate nohighlight">\(n\)</span> is odd. by <span class="math notranslate nohighlight">\(\Omega_{2h}\)</span> we denote the grid obtained by going from <span class="math notranslate nohighlight">\(h\)</span> to <span class="math notranslate nohighlight">\(2h\)</span>. We have</p>
<div class="math notranslate nohighlight">
\[
x_i^{2h} = i(2h) = x_{2i}^h.
\]</div>
<p>So the point <span class="math notranslate nohighlight">\(x_i\)</span> on level <span class="math notranslate nohighlight">\(2h\)</span> is the same as the point <span class="math notranslate nohighlight">\(2i\)</span> on the grid with level <span class="math notranslate nohighlight">\(h\)</span>. Correspondingly for the eigenmode <span class="math notranslate nohighlight">\(v_k\)</span> we have</p>
<div class="math notranslate nohighlight">
\[
v_k(x_{2i}^h) = \sin(k\pi x_{2i}^h) = \sin(k\pi x_i^{2h}) = v_k^{2h}(x_i^{2h})
\]</div>
<p>What does this mean? Eigenmodes on the finer level are sampled down to eigenmodes on the coarser level with the same index. Hence, if we have the eigenmode with index <span class="math notranslate nohighlight">\(k\approx \frac{n}{2}\)</span> on the finer level, which is on the edge between low and high oscillatory modes, it becomes a high oscillatory mode on the level <span class="math notranslate nohighlight">\(2h\)</span> as it is the highest eigenmode here and will hence be effectively reduced. Let us consider the corresponding reduction factors on each level.</p>
<p>On the fine level the reduction factor is <span class="math notranslate nohighlight">\(1 - \sin^2\frac{k\pi}{2(n+1)}\approx \frac{1}{2}\)</span> on the fine mode for <span class="math notranslate nohighlight">\(k\approx \frac{n}{2}\)</span>. However, on the coarser mode the corresponding reduction factor reduces to <span class="math notranslate nohighlight">\(1 - \sin^2\frac{n/2 \pi}{2(n/2 + 1)}\approx 0\)</span>, leading to a rapid reduction of this error component.</p>
</section>
<section id="moving-between-the-fine-mesh-and-the-coarse-mesh">
<h2>Moving between the fine mesh and the coarse mesh<a class="headerlink" href="#moving-between-the-fine-mesh-and-the-coarse-mesh" title="Permalink to this headline">#</a></h2>
<p>To move between the fine mesh and the coarse mesh we define a prolongation and a restriction operator. The prolongation operator <span class="math notranslate nohighlight">\(I_{2h}^h\)</span> takes us from <span class="math notranslate nohighlight">\(\Omega_{2h}\)</span> (the coarse mesh) to <span class="math notranslate nohighlight">\(\Omega_h\)</span> (the fine mesh). Let <span class="math notranslate nohighlight">\(v^{h} = I_{2h}^hv^{2h}\)</span> be the map between the vector <span class="math notranslate nohighlight">\(v^{2h}\)</span> on the coarse mesh and <span class="math notranslate nohighlight">\(v^{h}\)</span> on the fine mesh. We define the entries of <span class="math notranslate nohighlight">\(v^{h}\)</span> by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
v_{2j}^h &amp;= v_j^{2h}\nonumber\\
v_{2j+1}^h &amp;= \left(v_j^{2h} + v_{j+1}^{2h}\right)/2\nonumber
\end{align}
\end{split}\]</div>
<p>Hence, for even <span class="math notranslate nohighlight">\(j\)</span> we just transfer the corresponding value onto the fine mesh. For the in-between values we take the average. In matrix form the operator looks like</p>
<div class="math notranslate nohighlight">
\[\begin{split}
v^{h} = \frac{1}{2}\begin{bmatrix}1    &amp;    &amp;    &amp;   \\
                                  2    &amp;    &amp;    &amp;   \\
                                  1    &amp;  1 &amp;    &amp;   \\
                                       &amp;  2 &amp;    &amp;   \\
                                       &amp;  1 &amp; 1  &amp;   \\
                                       &amp;    &amp; \vdots &amp; \\
                                       &amp;    &amp; \vdots &amp; \\
                                       &amp;    &amp; 1     &amp;  1 \\
                                       &amp;    &amp;        &amp; 2 \\
                                       &amp;    &amp;       &amp;  1 \end{bmatrix}v^{2h}
\end{split}\]</div>
<p>The restriction operator <span class="math notranslate nohighlight">\(I_h^{2h}\)</span> is defined by</p>
<div class="math notranslate nohighlight">
\[
I_h^{2h}v^{h} = v^{2h}
\]</div>
<p>with <span class="math notranslate nohighlight">\(v_j^{2h} = \frac{1}{4}\left(v_{2j-1}^h + 2v_{2j}^h + v_{2j+1}^h\right)\)</span>. It follows that</p>
<div class="math notranslate nohighlight">
\[
I_{2h}^h = 2(I_h^{2h})^T.
\]</div>
<p>Hence, the restriction factor is up to the factor <span class="math notranslate nohighlight">\(2\)</span> just the transpose of the prolongation operator.</p>
</section>
<section id="the-full-multigrid-cycle">
<h2>The full multigrid cycle<a class="headerlink" href="#the-full-multigrid-cycle" title="Permalink to this headline">#</a></h2>
<p>We now want to solve</p>
<div class="math notranslate nohighlight">
\[
A_hu^h = f^h
\]</div>
<p>on the fine grid.</p>
<p>We define a smoothing operation</p>
<div class="math notranslate nohighlight">
\[
u_{\nu}^h = \text{smooth}(A_h, u_0^{h}, f_h)
\]</div>
<p>by performing <span class="math notranslate nohighlight">\(\nu\)</span> steps of the Richardson iteration. This rapidly reduces the high frequency error components, that’s why the name smoothing is chosen. A <strong>two grid cycle</strong> now takes the following form</p>
<ul class="simple">
<li><p>Pre-smooth <span class="math notranslate nohighlight">\(u^{h} := \text{smooth}^{\nu_1}(A_h, u_0^h, f^{h})\)</span></p></li>
<li><p>Compute the residual <span class="math notranslate nohighlight">\(r^{h} = f^{h} - A_hu^{h}\)</span></p></li>
<li><p>Coarsen <span class="math notranslate nohighlight">\(r^{2h} = I_h^{2h}r^{h}\)</span></p></li>
<li><p>Solve <span class="math notranslate nohighlight">\(A_{2h}\delta^{2h} = r^{2h}\)</span></p></li>
<li><p>Correct <span class="math notranslate nohighlight">\(u^{h} := u^{h} + I_{2h}^{h}\delta^{2h}\)</span></p></li>
<li><p>Post-smooth <span class="math notranslate nohighlight">\(u^{h} := \text{smooth}^{\nu_2}(A_h, u^{h}, f^{h})\)</span></p></li>
</ul>
<p>Instead of solving the system on the coarse grid we can recursively continue and move to a coarser cycle of size <span class="math notranslate nohighlight">\(4h\)</span> and so on. There is significant freedom in choosing the parameters and the precise implementation depends on the application context.</p>
<p>We can apply a sequence of multigrid cycles directly as an iterative solver for the system on the finest level. We just repeat the above steps until convergence. Alternatively, we can apply a single (or multiple) multigrid steps as an effective preconditioner for a Krylov subspace solver.</p>
</section>
<section id="algebraic-multigrid">
<h2>Algebraic multigrid<a class="headerlink" href="#algebraic-multigrid" title="Permalink to this headline">#</a></h2>
<p>The method derived above is called a geometric multigrid method. It requires precise knowledge on the hierarchy of meshes to define the restriction and prolongation operators. These become more complicated in more than one dimension, but can be designed. Especially for regular meshes geometric multigrid methods can be easily implemented. However, for more general problems where we do not easily have a hierarchy of meshes (consider unstructured meshes) the above ideas do not translate easily. Here, one can use so-called <strong>algebraic multigrid methods (AMG)</strong>. These define restriction and prolongation operators directly on the matrix by analysing the matrix elements heuristically to simulate what a geometric multigrid solver might do if mesh information were available.</p>
<p>AMG has itself established as a highly efficient preconditioning tool for non-oscillatory PDE problems (e.g. Poisson type problems). They are available in PETSc and many other solvers and are the preconditioner of choice for many practical applications.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-dev-py"
        },
        kernelOptions: {
            kernelName: "conda-env-dev-py",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-dev-py'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="petsc_for_sparse_systems.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Using petsc4py for sparse linear systems</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="simple_time_stepping.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Simple time-stepping</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Timo Betcke & Matthew Scroggs<br/>
  
      &copy; Copyright 2020-22.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>